function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var e=t(require("react")),s=t(require("prop-types")),r=function(t){function s(){for(var e=this,r=[],n=arguments.length;n--;)r[n]=arguments[n];t.apply(this,r),this.state={errors:{},status:s.STATUS.INVALID,submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE),values:void 0},this.inputsState={},this.createDefaultValue=function(t){return"number"===t?1:"bool"!==t&&""},this.createDefaultValues=function(){var t=e.props,s=t.defaultValues;return Object.assign({},Object.entries(t.config).reduce(function(t,s){var r=s[1];return t[s[0]]=void 0!==r.defaultValue?r.defaultValue:e.createDefaultValue(r.type),t},{}),s)},this.getHandler=function(t,e){return function(s,r){if(t.handlers&&"function"==typeof t.handlers[e])return t.handlers[e](s,r);if(!0===t.required&&!0!==t.customValidation&&"isValid"===e)throw new Error("You must set isValid handler");return"isValid"===e||s}},this.getSubmitResponseMessages=function(t,e){return"function"==typeof t?t(e):t||""},this.initializeInputsState=function(t){return Object.entries(e.props.config).reduce(function(e,r){var n=r[0];return r[1].required&&(t[n]?e.inputsState[n]=!0:(e.inputsState[n]=!1,e.status=s.STATUS.INVALID)),e},{inputsState:{},status:s.STATUS.VALID})},this.resetSubmitResponse=function(){e.setState({submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE)})},this.updateErrors=function(t){var r=t.op,n=t.inputName,u=t.inputConfig,a=t.errorMessage;return function(t){var i={status:t.status,errors:Object.assign({},t.errors)};return"add"===r?(e.inputsState[n]=!1,i.errors[n]=a||u.errorMessage,i.status=s.STATUS.INVALID):(e.inputsState[n]=!0,delete i.errors[n],i.status=Object.values(e.inputsState).reduce(function(t,e){return e||(t+=1),t},0)>0?s.STATUS.INVALID:s.STATUS.VALID),i}},this.updateErrorMessage=function(t,s){e.setState(e.updateErrors({op:s?"add":"remove",inputName:t,inputConfig:e.props.config[t],errorMessage:s}))},this.updateInputValue=function(t,s){e.setState(function(r){var n;return{values:Object.assign({},r.values,((n={})[t]=e.getHandler(e.props.config[t],"transformBeforeSave")(s),n))}})},this.updateStatus=function(t){e.setState({status:t})},this.updaters={updateErrorMessage:this.updateErrorMessage,updateInputValue:this.updateInputValue,updateStatus:this.updateStatus},this.validateForm=function(t,r){return Object.entries(e.props.config).reduce(function(r,n){var u=n[0],a=n[1];return e.validateInput({inputConfig:a,inputName:u,values:t,updateState:!1})?delete r.errors[u]:(r.status=s.STATUS.INVALID,r.errors[u]=a.errorMessage),r},{status:s.STATUS.VALID,errors:r})},this.validateInput=function(t){var s=t.inputName,r=t.inputConfig,n=t.values,u=t.updateState,a=e.getHandler(r,"isValid")(n[s],n);return a=!(!0===r.required&&!1===a),u&&e.setState(e.updateErrors({op:a?"remove":"add",inputName:s,inputConfig:r})),a},this.onInputChange=function(t){var s=t.currentTarget?t.currentTarget:t,r=s.name,n=s.value,u=e.props.config;e.setState(function(t){var s;return{values:Object.assign({},t.values,((s={})[r]=e.getHandler(u[r],"transformBeforeSave")(n),s))}},function(){e.validateInput({inputConfig:u[r],inputName:r,updateState:!0,values:e.state.values})})},this.onSubmit=function(t){t.preventDefault();var r=e.props,n=r.submitResponseMessages,u=r.onSubmit,a=e.state,i=a.values;if(a.status===s.STATUS.INVALID)return null;var o=Object.entries(r.config).reduce(function(t,s){var r=s[0];return t[r]=e.getHandler(s[1],"transformBeforeSubmit")(i[r]),t},{});return e.setState({status:s.STATUS.LOADING,submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE)}),u(o).then(function(t){e.setState({status:s.STATUS.VALID,submitResponse:{type:s.SUBMIT_RESPONSE_TYPES.SUCCESS,message:e.getSubmitResponseMessages(n.success,t),show:!0}})}).catch(function(t){e.setState({status:s.STATUS.VALID,submitResponse:{type:s.SUBMIT_RESPONSE_TYPES.FAILURE,message:e.getSubmitResponseMessages(n.failure,t),show:!0}})})}}return t&&(s.__proto__=t),(s.prototype=Object.create(t&&t.prototype)).constructor=s,s.prototype.componentDidMount=function(){var t=this,e=this.createDefaultValues();this.setState(this.props.validateAtDidMount?function(s){return Object.assign({},{values:e},t.validateForm(e,Object.assign({},s.errors)))}:Object.assign({},{values:e},this.initializeInputsState(e)))},s.prototype.render=function(){var t=this.state,s=t.values;return s?e.createElement("form",null,(0,this.props.children)({errors:t.errors,onInputChange:this.onInputChange,onSubmit:this.onSubmit,resetSubmitResponse:this.resetSubmitResponse,status:t.status,submitResponse:t.submitResponse,updaters:this.updaters,values:s})):null},s}(e.Component);r.STATUS={VALID:1,INVALID:2,LOADING:3},r.SUBMIT_RESPONSE_TYPES={SUCCESS:0,FAILURE:1},r.SUBMIT_RESPONSE_INITIAL_STATE={type:r.SUBMIT_RESPONSE_TYPES.SUCCESS,message:"",show:!1},r.propTypes={config:s.object.isRequired,children:s.func.isRequired,onSubmit:s.func.isRequired,defaultValues:s.object,submitResponseMessages:s.shape({success:s.oneOfType([s.string,s.func]),failure:s.oneOfType([s.string,s.func])}),validateAtDidMount:s.bool},r.defaultProps={defaultValues:{},submitResponseMessages:{},validateAtDidMount:!1},module.exports=r;
//# sourceMappingURL=form.js.map
