!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):e["@diegofrayo/form"]=t(e.react,e.PropTypes)}(this,function(e,t){e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var s=function(t){function s(){for(var e=this,r=[],n=arguments.length;n--;)r[n]=arguments[n];t.apply(this,r),this.state={errors:{},status:s.STATUS.INVALID,submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE),values:void 0},this.inputsState={},this.createDefaultValue=function(e){return"number"===e?1:"bool"!==e&&""},this.createDefaultValues=function(){var t=e.props,s=t.defaultValues;return Object.assign({},Object.entries(t.config).reduce(function(t,s){var r=s[1];return t[s[0]]=void 0!==r.defaultValue?r.defaultValue:e.createDefaultValue(r.type),t},{}),s)},this.getHandler=function(e,t){return function(s,r){if(e.handlers&&"function"==typeof e.handlers[t])return e.handlers[t](s,r);if(!0===e.required&&!0!==e.customValidation&&"isValid"===t)throw new Error("You must set isValid handler");return"isValid"===t||s}},this.getSubmitResponseMessages=function(e,t){return"function"==typeof e?e(t):e||""},this.initializeInputsState=function(t){return Object.entries(e.props.config).reduce(function(e,r){var n=r[0];return r[1].required&&(t[n]?e.inputsState[n]=!0:(e.inputsState[n]=!1,e.status=s.STATUS.INVALID)),e},{inputsState:{},status:s.STATUS.VALID})},this.resetSubmitResponse=function(){e.setState({submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE)})},this.updateErrors=function(t){var r=t.op,n=t.inputName,u=t.inputConfig,a=t.errorMessage;return function(t){var i={status:t.status,errors:Object.assign({},t.errors)};return"add"===r?(e.inputsState[n]=!1,i.errors[n]=a||u.errorMessage,i.status=s.STATUS.INVALID):(e.inputsState[n]=!0,delete i.errors[n],i.status=Object.values(e.inputsState).reduce(function(e,t){return t||(e+=1),e},0)>0?s.STATUS.INVALID:s.STATUS.VALID),i}},this.updateErrorMessage=function(t,s){e.setState(e.updateErrors({op:s?"add":"remove",inputName:t,inputConfig:e.props.config[t],errorMessage:s}))},this.updateInputValue=function(t,s){e.setState(function(r){var n;return{values:Object.assign({},r.values,((n={})[t]=e.getHandler(e.props.config[t],"transformBeforeSave")(s),n))}})},this.updateStatus=function(t){e.setState({status:t})},this.updaters={updateErrorMessage:this.updateErrorMessage,updateInputValue:this.updateInputValue,updateStatus:this.updateStatus},this.validateForm=function(t,r){return Object.entries(e.props.config).reduce(function(r,n){var u=n[0],a=n[1];return e.validateInput({inputConfig:a,inputName:u,values:t,updateState:!1})?delete r.errors[u]:(r.status=s.STATUS.INVALID,r.errors[u]=a.errorMessage),r},{status:s.STATUS.VALID,errors:r})},this.validateInput=function(t){var s=t.inputName,r=t.inputConfig,n=t.values,u=t.updateState,a=e.getHandler(r,"isValid")(n[s],n);return a=!(!0===r.required&&!1===a),u&&e.setState(e.updateErrors({op:a?"remove":"add",inputName:s,inputConfig:r})),a},this.onInputChange=function(t){var s=t.currentTarget?t.currentTarget:t,r=s.name,n=s.value,u=e.props.config;e.setState(function(t){var s;return{values:Object.assign({},t.values,((s={})[r]=e.getHandler(u[r],"transformBeforeSave")(n),s))}},function(){e.validateInput({inputConfig:u[r],inputName:r,updateState:!0,values:e.state.values})})},this.onSubmit=function(t){t.preventDefault();var r=e.props,n=r.submitResponseMessages,u=r.onSubmit,a=e.state,i=a.values;if(a.status===s.STATUS.INVALID)return null;var o=Object.entries(r.config).reduce(function(t,s){var r=s[0];return t[r]=e.getHandler(s[1],"transformBeforeSubmit")(i[r]),t},{});return e.setState({status:s.STATUS.LOADING,submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE)}),u(o).then(function(t){e.setState({status:s.STATUS.VALID,submitResponse:{type:s.SUBMIT_RESPONSE_TYPES.SUCCESS,message:e.getSubmitResponseMessages(n.success,t),show:!0}})}).catch(function(t){e.setState({status:s.STATUS.VALID,submitResponse:{type:s.SUBMIT_RESPONSE_TYPES.FAILURE,message:e.getSubmitResponseMessages(n.failure,t),show:!0}})})}}return t&&(s.__proto__=t),(s.prototype=Object.create(t&&t.prototype)).constructor=s,s.prototype.componentDidMount=function(){var e=this,t=this.createDefaultValues();this.setState(this.props.validateAtDidMount?function(s){return Object.assign({},{values:t},e.validateForm(t,Object.assign({},s.errors)))}:Object.assign({},{values:t},this.initializeInputsState(t)))},s.prototype.render=function(){var t=this.state,s=t.values;return s?e.createElement("form",null,(0,this.props.children)({errors:t.errors,onInputChange:this.onInputChange,onSubmit:this.onSubmit,resetSubmitResponse:this.resetSubmitResponse,status:t.status,submitResponse:t.submitResponse,updaters:this.updaters,values:s})):null},s}(e.Component);return s.STATUS={VALID:1,INVALID:2,LOADING:3},s.SUBMIT_RESPONSE_TYPES={SUCCESS:0,FAILURE:1},s.SUBMIT_RESPONSE_INITIAL_STATE={type:s.SUBMIT_RESPONSE_TYPES.SUCCESS,message:"",show:!1},s.propTypes={config:t.object.isRequired,children:t.func.isRequired,onSubmit:t.func.isRequired,defaultValues:t.object,submitResponseMessages:t.shape({success:t.oneOfType([t.string,t.func]),failure:t.oneOfType([t.string,t.func])}),validateAtDidMount:t.bool},s.defaultProps={defaultValues:{},submitResponseMessages:{},validateAtDidMount:!1},s});
//# sourceMappingURL=form.umd.js.map
