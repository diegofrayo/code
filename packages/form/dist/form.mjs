import t from"react";import e from"prop-types";var s=function(e){function s(){for(var t=this,r=[],n=arguments.length;n--;)r[n]=arguments[n];e.apply(this,r),this.state={errors:{},status:s.STATUS.INVALID,submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE),values:void 0},this.inputsState={},this.createDefaultValue=function(t){return"number"===t?1:"bool"!==t&&""},this.createDefaultValues=function(){var e=t.props,s=e.defaultValues;return Object.assign({},Object.entries(e.config).reduce(function(e,s){var r=s[1];return e[s[0]]=void 0!==r.defaultValue?r.defaultValue:t.createDefaultValue(r.type),e},{}),s)},this.getHandler=function(t,e){return function(s,r){if(t.handlers&&"function"==typeof t.handlers[e])return t.handlers[e](s,r);if(!0===t.required&&!0!==t.customValidation&&"isValid"===e)throw new Error("You must set isValid handler");return"isValid"===e||s}},this.getSubmitResponseMessages=function(t,e){return"function"==typeof t?t(e):t||""},this.initializeInputsState=function(e){return Object.entries(t.props.config).reduce(function(t,r){var n=r[0];return r[1].required&&(e[n]?t.inputsState[n]=!0:(t.inputsState[n]=!1,t.status=s.STATUS.INVALID)),t},{inputsState:{},status:s.STATUS.VALID})},this.resetSubmitResponse=function(){t.setState({submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE)})},this.updateErrors=function(e){var r=e.op,n=e.inputName,u=e.inputConfig,a=e.errorMessage;return function(e){var i={status:e.status,errors:Object.assign({},e.errors)};return"add"===r?(t.inputsState[n]=!1,i.errors[n]=a||u.errorMessage,i.status=s.STATUS.INVALID):(t.inputsState[n]=!0,delete i.errors[n],i.status=Object.values(t.inputsState).reduce(function(t,e){return e||(t+=1),t},0)>0?s.STATUS.INVALID:s.STATUS.VALID),i}},this.updateErrorMessage=function(e,s){t.setState(t.updateErrors({op:s?"add":"remove",inputName:e,inputConfig:t.props.config[e],errorMessage:s}))},this.updateInputValue=function(e,s){t.setState(function(r){var n;return{values:Object.assign({},r.values,((n={})[e]=t.getHandler(t.props.config[e],"transformBeforeSave")(s),n))}})},this.updateStatus=function(e){t.setState({status:e})},this.updaters={updateErrorMessage:this.updateErrorMessage,updateInputValue:this.updateInputValue,updateStatus:this.updateStatus},this.validateForm=function(e,r){return Object.entries(t.props.config).reduce(function(r,n){var u=n[0],a=n[1];return t.validateInput({inputConfig:a,inputName:u,values:e,updateState:!1})?delete r.errors[u]:(r.status=s.STATUS.INVALID,r.errors[u]=a.errorMessage),r},{status:s.STATUS.VALID,errors:r})},this.validateInput=function(e){var s=e.inputName,r=e.inputConfig,n=e.values,u=e.updateState,a=t.getHandler(r,"isValid")(n[s],n);return a=!(!0===r.required&&!1===a),u&&t.setState(t.updateErrors({op:a?"remove":"add",inputName:s,inputConfig:r})),a},this.onInputChange=function(e){var s=e.currentTarget?e.currentTarget:e,r=s.name,n=s.value,u=t.props.config;t.setState(function(e){var s;return{values:Object.assign({},e.values,((s={})[r]=t.getHandler(u[r],"transformBeforeSave")(n),s))}},function(){t.validateInput({inputConfig:u[r],inputName:r,updateState:!0,values:t.state.values})})},this.onSubmit=function(e){e.preventDefault();var r=t.props,n=r.submitResponseMessages,u=r.onSubmit,a=t.state,i=a.values;if(a.status===s.STATUS.INVALID)return null;var o=Object.entries(r.config).reduce(function(e,s){var r=s[0];return e[r]=t.getHandler(s[1],"transformBeforeSubmit")(i[r]),e},{});return t.setState({status:s.STATUS.LOADING,submitResponse:Object.assign({},s.SUBMIT_RESPONSE_INITIAL_STATE)}),u(o).then(function(e){t.setState({status:s.STATUS.VALID,submitResponse:{type:s.SUBMIT_RESPONSE_TYPES.SUCCESS,message:t.getSubmitResponseMessages(n.success,e),show:!0}})}).catch(function(e){t.setState({status:s.STATUS.VALID,submitResponse:{type:s.SUBMIT_RESPONSE_TYPES.FAILURE,message:t.getSubmitResponseMessages(n.failure,e),show:!0}})})}}return e&&(s.__proto__=e),(s.prototype=Object.create(e&&e.prototype)).constructor=s,s.prototype.componentDidMount=function(){var t=this,e=this.createDefaultValues();this.setState(this.props.validateAtDidMount?function(s){return Object.assign({},{values:e},t.validateForm(e,Object.assign({},s.errors)))}:Object.assign({},{values:e},this.initializeInputsState(e)))},s.prototype.render=function(){var e=this.state,s=e.values;return s?t.createElement("form",null,(0,this.props.children)({errors:e.errors,onInputChange:this.onInputChange,onSubmit:this.onSubmit,resetSubmitResponse:this.resetSubmitResponse,status:e.status,submitResponse:e.submitResponse,updaters:this.updaters,values:s})):null},s}(t.Component);s.STATUS={VALID:1,INVALID:2,LOADING:3},s.SUBMIT_RESPONSE_TYPES={SUCCESS:0,FAILURE:1},s.SUBMIT_RESPONSE_INITIAL_STATE={type:s.SUBMIT_RESPONSE_TYPES.SUCCESS,message:"",show:!1},s.propTypes={config:e.object.isRequired,children:e.func.isRequired,onSubmit:e.func.isRequired,defaultValues:e.object,submitResponseMessages:e.shape({success:e.oneOfType([e.string,e.func]),failure:e.oneOfType([e.string,e.func])}),validateAtDidMount:e.bool},s.defaultProps={defaultValues:{},submitResponseMessages:{},validateAtDidMount:!1};export default s;
//# sourceMappingURL=form.mjs.map
